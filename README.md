# Otus
Введение
Для выполнения работы потребуются следующие инструменты:

VirtualBox - среда виртуализации, позволяет создавать и выполнять виртуальные машины;
Vagrant - ПО для создания и конфигурирования виртуальной среды. В данном случае в качестве среды виртуализации используется VirtualBox;
Packer - ПО для создания образов виртуальных машин;
Git - система контроля версий
А так же аккаунты:

GitHub - https://github.com/
Vagrant Cloud - https://app.vagrantup.com

Установка ПО

Vagrant
Переходим на https://www.vagrantup.com/downloads.html выбираем соответствующую версию. В данном случае Windows 10 Pro и версия 2.2.14. Скачиваем установочный файл.
После успешного окончания будет установлен Vagrant.

Packer
Переходим на https://www.packer.io/downloads.html выбираем соответствующую версию. В данном случае Linux 64-bit и версия 1.6.6. Скачиваем zip-файл.

После успешного окончания будет установлен Packer.

Kernel update
Клонирование и запуск
Для запуска рабочего виртуального окружения необходимо зайти через браузер в GitHub под своей учетной записью и выполнить fork данного репозитория: https://github.com/dmitry-lyutenko/manual_kernel_update

После этого данный репозиторий необходимо склонировать к себе на рабочую машину. Для этого воспользуемся ранее установленным приложением git, при этом в <user_name> будет имя уже вашего репозитрия:

git clone git@github.com:<user_name>/manual_kernel_update.git
В текущей директории появится папка с именем репозитория. В данном случае manual_kernel_update. Ознакомимся с содержимым:

cd manual_kernel_update
ls -1
manual
packer
Vagrantfile
Здесь:

manual - директория с данным руководством
packer - директория со скриптами для packer'а
Vagrantfile - файл описывающий виртуальную инфраструктуру для Vagrant
Запустим виртуальную машину и залогинимся:

vagrant up
...
==> kernel-update: Importing base box 'centos/7'...
...
==> kernel-update: Booting VM...
...
==> kernel-update: Setting hostname...

vagrant ssh
[vagrant@kernel-update ~]$ uname -r
3.10.0-957.12.2.el7.x86_64
Теперь приступим к обновлению ядра.

kernel update
Подключаем репозиторий, откуда возьмем необходимую версию ядра.

sudo yum install -y http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
В репозитории есть две версии ядер kernel-ml и kernel-lt. Первая является наиболее свежей стабильной версией, вторая это стабильная версия с длительной поддержкой, но менее свежая, чем первая. В данном случае ядро 5й версии будет в kernel-ml.

Поскольку мы ставим ядро из репозитория, то установка ядра похожа на установку любого другого пакета, но потребует явного включения репозитория при помощи ключа --enablerepo.

Ставим последнее ядро:

sudo yum --enablerepo elrepo-kernel install kernel-ml -y
grub update
После успешной установки нам необходимо сказать системе, что при загрузке нужно использовать новое ядро. В случае обновления ядра на рабочих серверах необходимо перезагрузиться с новым ядром, выбрав его при загрузке. И только при успешно прошедших загрузке нового ядра и тестах сервера переходить к загрузке с новым ядром по-умолчанию. В тестовой среде можно обойти данный этап и сразу назначить новое ядро по-умолчанию.

Обновляем конфигурацию загрузчика:

sudo grub2-mkconfig -o /boot/grub2/grub.cfg
Выбираем загрузку с новым ядром по-умолчанию:

sudo grub2-set-default 0
Перезагружаем виртуальную машину:

sudo reboot
После перезагрузки виртуальной машины (3-4 минуты, зависит от мощности хостовой машины) заходим в нее и выполняем:

uname -r
